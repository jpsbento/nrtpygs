gitlab_pull_test:
  needs: ["gitversioning"]
  stage: build
  image:
    name: python:3.10.10-slim-buster
    entrypoint: [""]
  before_script: []
    #- echo "machine ${CI_API_V4_URL}/projects/${HELM_PROJECT_REGISTRY_ID}/packages/pypi" > ~/.netrc
    #- echo "login gitlab-ci-token" >> ~/.netrc
    #- echo "password ${CI_JOB_TOKEN}" >> ~/.netrc
  script:
    # Building Package
    - echo "${GOOGLE_CLOUD_KEY_B64}" > key_encoded.json
    - base64 --decode key_encoded.json > key.json
    - export GOOGLE_APPLICATION_CREDENTIALS=key.json
    - pip install keyrings.google-artifactregistry-auth
    - keyring --list-backends
    # Uploading package
    - >
      pip install --index-url https://${GC_REGION}-python.pkg.dev/${GC_PROJECT_ID}/nrt-python-registry/simple nrtpygs
    - after_script: []
